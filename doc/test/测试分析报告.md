## 1 引言
### 1.1 编写目的
本文档的目的为制定软件详细的需求规格说明，以支持项目的后续开发。

本文档的主要预期读者为项目组开发人员，以及期望对软件做出贡献者。

### 1.2 背景
这里待开发的软件系统名为可扩展函数式程序设计语言 Merde。

本项目为湛忠胜所提出，开发者为湛忠胜、叶文、郭明昊。该软件在个人笔记本电脑上实现。

### 1.3 定义

### 1.4 参考资料
1. 软件需求说明书
2. 概要设计说明书
3. 测试计划
4. 详细设计说明书

## 2 测试概要

| 测试标识符 | 内容                 | 实际测试与计划的差异 |
| --------- | -------------------- | ------------------ |
| `test_lexer` | 为对词法分析（`Lexer`）模块进行的单元测试 | 无 |
| `untyped`    | 为对解释（`Interpret`）模块进行的单元测试 | 无 |
| `test_infer` | 为对双向类型检查（`Reconstruction`）模块进行的单元测试 | 无 |
| `combine_parser` | 整个系统中所有模块的集成测试 | 无 |

## 3 测试结果及发现
### 3.1 test_lexer
测试输出数据与预期输出完全一致，可见词法分析没有明显错误。

### 3.2 untyped
测试输出数据与预期输出完全一致，可见解释模块没有明显错误。

### 3.3 test_infer
运行测试时大多数测试都通过，但是出现了两个问题：

1. 等价类`test_let_poly`中的测试未通过，我们检查发现是对类型变量和实际类型合一时没有修改推导层级（见《详细设计说明书》5.6节情况6）导致的。
2. 等价类`test_record`中的测试3未通过，我们检查发现是检测某类型变量是否在一个实际类型中自由出现（见《详细设计说明书》5.6节情况6）时没有考虑行类型导致的。

我们修复了这些错误，重新运行，测试通过。

### 3.4 combine_parser
测试输出数据与预期输出完全一致，可见软件系统没有明显错误。

## 4 对软件功能的结论
### 4.1 语言层面支持可扩展函数式编程特性
#### 4.1.1 能力
这项功能要求语言层面可以表达第一类函数以及对结构体字段的增删，经过`untyped`和`combine_parser`测试说明其已实现。
#### 4.1.2 限制
无明确限制。

### 4.2 类型系统中要能对可扩展函数式编程建模
#### 4.2.1 能力
这项功能要求类型系统层面可以表达高阶函数以及对结构体字段的增删，经过`test_infer`和`combine_parser`测试说明其已实现。
#### 4.2.2 限制
测试中发现了类型推导中对可扩展编程实现的错误（见3.3节第2条），已修复。

### 4.3 类型系统中要能支持基本的泛型（let polymorphism）
#### 4.3.1 能力
这项功能要求类型系统能支持基本的泛型（let polymorphism 级别），经过`test_infer`和`combine_parser`测试说明其已实现。
#### 4.3.2 限制
测试中发现了类型推导中的错误（见3.3节第1条），已修复。

### 4.4 类型推导输出的类型必须是用户输入能对应的最优类型
#### 4.4.1 能力
这项功能要求类型推导的输出必须是最优的，经过`test_infer`和`combine_parser`测试说明其已实现（我们输出数据直接给出了理论上的最优类型，测试表面推出结果和最优结果是一致的）。
#### 4.4.2 限制
无明确限制。

### 4.5 输出的求值结果反映用户的要求
#### 4.5.1 能力
这项功能要求输出的值忠实的反映了语言的操作语义（见《概要设计说明书》3.1节），经过`untyped`和`combine_parser`测试说明其已实现。
#### 4.5.2 限制
无明确限制。

### 4.6 对于用户输入程序有错误的情况，要返回详尽的错误信息
#### 4.6.1 能力
这项功能要求当用户输入有错时，负责出错部分的模块能报告错误信息，经过`test_lexer`、`untyped`、`test_infer`和`combine_parser`测试说明其已实现。
#### 4.6.2 限制
无明确限制。

## 5 分析摘要
### 5.1 能力
我们进行的这些测试证实了本软件已经实现《软件需求说明书》中要求的能力。

### 5.2 缺陷和限制
目前已无未修复的缺陷。

### 5.3 建议
无。

### 5.4 评价
该软件开发已达到预期目标，可交付使用。

## 6 测试资源消耗
机时消耗在两分钟以内。