## 1 引言
### 1.1 编写目的
本文档的目的为制定软件详细的需求规格说明，以支持项目的后续开发。

本文档的主要预期读者为项目组开发人员，以及期望对软件做出贡献者。

### 1.2 背景
这里待开发的软件系统名为可扩展函数式程序设计语言 Merde。

本项目为湛忠胜所提出，开发者为湛忠胜、叶文、郭明昊。该软件在个人笔记本电脑上实现。

### 1.3 定义

### 1.4 参考资料
1. 软件需求说明书

## 2 总体设计
### 2.1 需求规定
下面只复述大体的功能需求，详尽的需求规定见参考文献1《软件需求说明书》第3节。
1. 语言层面支持可扩展函数式编程特性
2. 类型系统中要能对可扩展函数式编程建模
3. 类型系统中要能支持基本的泛型（let polymorphism）
4. 类型推导输出的类型必须是用户输入能对应的**最优**类型
5. 输出的求值结果反映用户的要求
6. 对于用户输入程序有错误的情况，要返回详尽的错误信息

### 2.2 运行环境
见参考文献1《软件需求说明书》第4节。

### 2.3 基本设计概念和处理流程
![分层数据流图](../../img/DFD.drawio.png)

### 2.4 结构

### 2.5 功能需求与程序的关系

### 2.6 人工处理过程
暂无。

### 2.7 尚未解决的问题
暂无。

## 3 接口设计
### 3.1 用户接口
用户接口为命令行界面，通过 REPL 式的接口与用户交互。

### 3.2 外部接口
### 3.3 内部接口

## 4 运行设计
### 4.1 运行模块组合
### 4.2 运行控制
### 4.3 运行时间

## 5 系统数据结构设计
### 5.1 逻辑结构设计要点
### 5.2 物理结构设计要点
### 5.3 数据结构与程序的关系

## 6 系统出错处理设计
### 6.1 出错信息
### 6.2 补救措施
### 6.3 系统维护设计


## Legacy
### 设计

我们采用模块化设计，包括词法分析、语法分析、双向类型检查（类型推导+类型检查）、解释、编译五大模块组成。

#### 词法分析

词法分析阶段是编译过程的第一个阶段。将源代码转换为一系列标记（tokens），每个标记代表一个独立的语法单元。

这个阶段的任务是读入源程序，即对构成源程序的字符流进行扫描然后根据构词规则识别单词(也称单词符号或符号)。词法分析程序可以使用lex等工具自动生成。

- 删除注释和空格
- 标识关键字、符号、标识符等

#### 语法分析

语法分析是编译过程的一个逻辑阶段。语法分析的任务是在词法分析的基础上将单词序列组合成各类语法短语，如“程序”，“语句”，“表达式”等等。语法分析程序判断源程序在结构上是否正确，源程序的结构由上下文无关文法描述。

- 确定语法规则
- 判断是否遵循语法规则
- 构建 AST

#### 双向类型检查

通过分析代码，确定表达式和变量的数据类型。该模块通常包括以下功能：

- 推导表达式的类型
- 检查变量之间的类型一致性
- 错误类型检测和报告

#### 解释模块

将 AST 转换为可执行的代码，并创建解释器来执行它们。

- 遍历 AST 并执行相应的操作
- 实现内置函数
- 管理变量和作用域

#### 编译模块

将 AST 转换为机器码或字节码。

- 生成目标代码
- 优化目标代码
- 管理内存和资源



