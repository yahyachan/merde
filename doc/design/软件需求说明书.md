# 软件需求说明书
## 1 引言
### 1.1 编写目的
本文档的目的为制定软件详细的需求规格说明，以支持项目的后续开发。

本文档的主要预期读者为项目组开发人员，以及期望对软件做出贡献者。

### 1.2 背景
这里待开发的软件系统名为可扩展函数式程序设计语言 Merde。

本项目为湛忠胜所提出，开发者为湛忠胜、叶文、郭明昊。该软件在个人笔记本电脑上实现。

### 1.3 定义
- 函数式编程：是一种编程范型，它将计算机上的运算视为函数运算，并且避免使用程序状态以及可变对象。在函数式编程中，函数是第一类对象即所谓高阶函数。这意味着一个函数，既可以作为其它函数的输入参数值，也可以从函数中返回值，被修改或者被分配给一个变量，相对于传统的过程式编程、面向对象编程而言极大的提高了表达力，增强了代码复用的能力。
- ML（Meta Language）：是一个函数式的通用的编程语言，著称于使用了多态的Hindley–Milner类型推导系统。其最早由图灵奖得主罗宾·米尔纳于爱丁堡大学研制，后来成为了静态类型函数式编程语言的典范。
- REPL（Read-Eval-Print Loop）：是一种简明清晰的交互式编程环境。意即不断读入用户输入（read），求值（eval），然后将结果实时反馈（print）给用户的一个循环过程（loop）。
- let polymorphism：一种较为受限的泛型，认为一个表达式的泛型中的$\forall$符号只能出现在最左，但也可以支持用let定义的中间变量自身带有泛型，故称 let polymorphism。虽然较之最一般泛型（System F）受限，但是已经足以涵盖大多数编程中业务逻辑的需求了。

### 1.4 参考资料

## 2 任务概述
### 2.1 目标
我们这里计划实现一个可扩展的类 ML 静态类型函数式编程语言。这里可扩展指的是语言中的复合结构（如结构体或者类）易于扩展，可以动态的在其中加入、删除一个字段，但同时又能用静态类型系统在编译时确保类型安全。作为函数式编程语言，我们肯定会支持高阶函数。此外我们还计划实现强大的类型推导，使得用户可以在几乎不标注任何变量、函数参数、函数返回值的情况下能让类型推导器推出所有类型（也就是所谓全局类型推导），但这里强大类型推导又不会过多的约束类型系统的表达力，类型系统将支持可扩展的类型特性以及基础的泛型。

在现有的主流语言中，可扩展的编程方式一定程度上存在（JavaScript 的原型面向对象编程就可以视为动态向对象加入字段），但是鲜有主流语言能对这一行为进行好的类型系统层面建模（TypeScript 引入了类，极大的降低了灵活性），遑论进行强大的类型推导。

本软件产品是一项独立的软件，而且全部内容自含。

### 2.2 用户的特点
本软件的目标用户为专业程序员，对函数式编程有一定理解。软件的预期使用频度可以任意大。

### 2.3 假定和约束
开发期限假定为三个月之内。

## 3 需求规定
### 3.1 对功能的规定
要求输入为用户程序（字符串的形式），经过如下的处理：
1. 词法分析
2. 语法分析
3. 类型推导和类型检查
4. 解释
最终输出为类型和求值结果，二者都以字符串的形式返回给用户。

具体来说要满足这些要求：
1. 语言层面支持可扩展函数式编程特性
2. 类型系统中要能对可扩展函数式编程建模
3. 类型系统中要能支持基本的泛型（let polymorphism）
4. 类型推导输出的类型必须是用户输入能对应的**最优**类型
5. 输出的求值结果反映用户的要求
6. 对于用户输入程序有错误的情况，要返回详尽的错误信息

### 3.2 对性能的规定
#### 3.2.1 精度
没有特殊要求。

#### 3.2.2 时间特性要求
作为一个图灵完备的程序语言解释器，运行的时间是可以任意长的，无法提出时间要求。

#### 3.2.3 灵活性
1. 我们要求软件能适应其他（REPL之外）的操作方式。。
2. 我们要求软件能方便的适应类型系统或者语言本身的扩展。

### 3.3 输入输出要求
软件的输入、输出都是以字符串形式体现的。

### 3.4 数据管理能力要求
无。

### 3.5 故障处理要求
可能出现的故障有：
- 词法分析错误
- 语法分析错误
- 类型出现等值自递归
- 两个表达式的类型不匹配
- 找不到变量
- 运行（解释）时类型错误

这些故障不影响软件的性能，但是遇到故障时都应该向用户提供详尽的错误信息。

### 3.6 其他专门要求
无。

## 4 运行环境规定
### 4.1 设备
支持的处理器为 X86-64 架构处理器，对内外存容量没有明确要求。

### 4.2 支持软件
支持 Windows 10 及以上版本、Linux 5.15 及以上版本的操作系统。

编译程序为 OCaml 5.0.0，构建工具为 Dune 3.6.1。

所用的单元测试框架为 OUnit 2.2.6。

### 4.3 接口
软件接口为命令行界面，通过 REPL 式的接口与用户交互。

### 4.4 控制
控制运行只需要用户在命令行界面输入的指令。